<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sankey Diagram - Interactive Flow</title>
    <script src="./d3.v7.min.js"></script> <!-- Local D3.js -->
    <script src="./d3-sankey.min.js"></script> <!-- Sankey Library -->
    <style>
        body {
            font-family: 'Roboto', Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f5f5f5;
        }
        h1 {
            text-align: center;
            margin: 20px 0;
            color: #333;
        }
        .dropdown-container {
            display: flex;
            justify-content: center;
            margin: 20px;
        }
        select {
            font-size: 16px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        svg {
            display: block;
            margin: 0 auto;
            background-color: #ffffff;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        .node {
            fill: #6aaedf;
            stroke: #3b82f6;
            stroke-width: 2;
            cursor: pointer;
        }
        .node:hover {
            fill: #1e40af;
        }
        .link {
            fill: none;
            stroke-opacity: 0.4;
        }
        .link.highlight {
            stroke-opacity: 0.8;
            stroke: #ff5722;
        }
        text {
            font-size: 12px;
            fill: #333;
        }
    </style>
</head>
<body>
    <h1>Sankey Diagram - Requisition Flow</h1>
    <div class="dropdown-container">
        <select id="transitionDropdown" onchange="highlightFlow()">
            <option value="">Select a transition...</option>
        </select>
    </div>
    <svg width="900" height="600"></svg>
    <script>
        // Sankey Data
        const sankeyData = {
            nodes: [
                { id: "Draft", role: "Initiator" },
                { id: "Submitted", role: "Initiator" },
                { id: "Approved", role: "Manager" },
                { id: "Rejected", role: "Manager" },
                { id: "Closed", role: "Admin" },
                { id: "Cancelled", role: "Admin" },
                { id: "Review", role: "Manager" },
                // Add more nodes for additional transitions
            ],
            links: [
                { source: "Draft", target: "Submitted", value: 5 },
                { source: "Submitted", target: "Approved", value: 10 },
                { source: "Submitted", target: "Rejected", value: 4 },
                { source: "Approved", target: "Closed", value: 8 },
                { source: "Draft", target: "Cancelled", value: 3 },
                { source: "Review", target: "Approved", value: 6 },
                // Add more transitions for variety
            ],
        };

        // Populate Dropdown
        const dropdown = document.getElementById("transitionDropdown");
        sankeyData.links.forEach((link, i) => {
            const option = document.createElement("option");
            option.value = i;
            option.textContent = `${link.source} ➡️ ${link.target}`;
            dropdown.appendChild(option);
        });

        // Set up SVG and Sankey
        const svg = d3.select("svg");
        const sankey = d3.sankey()
            .nodeWidth(20)
            .nodePadding(10)
            .size([900, 600])
            .nodeAlign(d3.sankeyCenter);

        const { nodes, links } = sankey(sankeyData);

        // Add Links
        const link = svg.append("g")
            .selectAll(".link")
            .data(links)
            .enter()
            .append("path")
            .attr("class", "link")
            .attr("d", d3.sankeyLinkHorizontal())
            .attr("stroke", "#999")
            .attr("stroke-width", d => Math.max(1, d.width));

        // Add Nodes
        const node = svg.append("g")
            .selectAll(".node")
            .data(nodes)
            .enter()
            .append("rect")
            .attr("class", "node")
            .attr("x", d => d.x0)
            .attr("y", d => d.y0)
            .attr("height", d => d.y1 - d.y0)
            .attr("width", d => d.x1 - d.x0);

        // Add Node Labels
        svg.append("g")
            .selectAll("text")
            .data(nodes)
            .enter()
            .append("text")
            .attr("x", d => (d.x0 + d.x1) / 2)
            .attr("y", d => (d.y0 + d.y1) / 2)
            .attr("dy", "0.35em")
            .attr("text-anchor", "middle")
            .text(d => d.id);

        // Highlight Flow
        function highlightFlow() {
            const selectedIndex = dropdown.value;
            if (selectedIndex === "") {
                link.classed("highlight", false);
                return;
            }

            const selectedLink = sankeyData.links[selectedIndex];
            link.classed("highlight", d => d === selectedLink);
        }
    </script>
</body>
</html>
