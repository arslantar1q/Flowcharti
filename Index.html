<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Requisition Flowchart</title>
    <script src="./d3.v7.min.js"></script> <!-- Local D3.js -->
    <style>
        body {
            font-family: Arial, sans-serif;
        }
        .node {
            fill: #6aaedf;
            stroke: #3b82f6;
            stroke-width: 2;
        }
        .node:hover {
            fill: #1e40af;
            cursor: pointer;
        }
        .link {
            fill: none;
            stroke: #ccc;
            stroke-width: 2px;
        }
        .highlight {
            stroke: #ff5722;
            stroke-width: 3px;
        }
        text {
            font-size: 12px;
            text-anchor: middle;
        }
        .input-container {
            margin: 20px;
        }
    </style>
</head>
<body>
    <h1>Interactive Requisition Flowchart</h1>
    <div class="input-container">
        <input id="stateInput" placeholder="Enter state (e.g., Draft)" />
        <button onclick="highlightState()">Show Next States</button>
    </div>
    <svg width="800" height="500"></svg>
    <script>
        const states = [
            { id: "Draft", x: 100, y: 100 },
            { id: "Submitted", x: 300, y: 100 },
            { id: "Approved", x: 500, y: 100 },
            { id: "Cancelled", x: 100, y: 300 },
            { id: "Rejected", x: 300, y: 300 },
            { id: "Closed", x: 500, y: 300 },
        ];

        const transitions = [
            { source: "Draft", target: "Submitted", label: "Submit" },
            { source: "Draft", target: "Cancelled", label: "Cancel" },
            { source: "Submitted", target: "Approved", label: "Approve" },
            { source: "Submitted", target: "Rejected", label: "Reject" },
            { source: "Approved", target: "Closed", label: "Close" },
        ];

        const svg = d3.select("svg");
        const linkGroup = svg.append("g").attr("class", "links");
        const nodeGroup = svg.append("g").attr("class", "nodes");

        // Draw links (arrows)
        const links = linkGroup.selectAll("line")
            .data(transitions)
            .enter()
            .append("line")
            .attr("class", "link")
            .attr("x1", d => states.find(s => s.id === d.source).x)
            .attr("y1", d => states.find(s => s.id === d.source).y)
            .attr("x2", d => states.find(s => s.id === d.target).x)
            .attr("y2", d => states.find(s => s.id === d.target).y);

        // Add link labels
        linkGroup.selectAll("text")
            .data(transitions)
            .enter()
            .append("text")
            .attr("x", d => (states.find(s => s.id === d.source).x + states.find(s => s.id === d.target).x) / 2)
            .attr("y", d => (states.find(s => s.id === d.source).y + states.find(s => s.id === d.target).y) / 2 - 10)
            .text(d => d.label);

        // Draw nodes (circles)
        const nodes = nodeGroup.selectAll("circle")
            .data(states)
            .enter()
            .append("circle")
            .attr("class", "node")
            .attr("cx", d => d.x)
            .attr("cy", d => d.y)
            .attr("r", 25);

        // Add node labels
        nodeGroup.selectAll("text")
            .data(states)
            .enter()
            .append("text")
            .attr("x", d => d.x)
            .attr("y", d => d.y + 5)
            .text(d => d.id);

        // Highlight function
        function highlightState() {
            const input = document.getElementById("stateInput").value;
            const nextStates = transitions
                .filter(t => t.source === input)
                .map(t => t.target);

            // Reset highlights
            nodes.classed("highlight", false);
            links.classed("highlight", false);

            // Highlight matching nodes and links
            nodes.filter(d => d.id === input || nextStates.includes(d.id))
                .classed("highlight", true);

            links.filter(d => d.source === input)
                .classed("highlight", true);
        }
    </script>
</body>
</html>
